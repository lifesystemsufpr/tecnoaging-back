generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                  String              @id @default(uuid())
  cpf                 String              @unique
  fullName            String
  fullName_normalized String              @default("") @db.Text
  password            String
  updatedAt           DateTime            @updatedAt
  active              Boolean             @default(true)
  gender              Gender
  role                SystemRole
  phone               String?
  healthProfessional  HealthProfessional?
  patient             Patient?
  researcher          Researcher?

  @@index([fullName_normalized])
  @@map("tecnoAging_user")
}

model Researcher {
  id            String      @id @unique
  email         String      @unique
  institutionId String
  updatedAt     DateTime    @updatedAt
  active        Boolean     @default(true)
  fieldOfStudy  String?
  user          User        @relation(fields: [id], references: [id])
  institution   Institution @relation(fields: [institutionId], references: [id])

  @@index([institutionId])
  @@map("researcher")
}

model HealthProfessional {
  id                    String            @id @unique
  email                 String            @unique
  updatedAt             DateTime          @updatedAt
  active                Boolean           @default(true)
  speciality            String
  speciality_normalized String            @default("") @db.Text
  evaluation            Evaluation[]
  user                  User              @relation(fields: [id], references: [id])
  avaliacoesIvcf20      AvaliacaoIvcf20[]

  @@index([speciality])
  @@index([speciality_normalized])
  @@index([active])
  @@map("health_professional")
}

model Institution {
  id               String       @id @default(uuid())
  title            String
  title_normalized String       @default("") @db.Text
  active           Boolean      @default(true)
  researchers      Researcher[]

  @@index([title_normalized])
  @@index([active])
  @@map("institution")
}

model Patient {
  id                   String              @id @unique
  birthday             DateTime            @db.Date
  weight               Int
  height               Int
  zipCode              String
  street               String
  number               String
  complement           String?
  city                 String
  state                String
  neighborhood         String
  updatedAt            DateTime            @updatedAt
  active               Boolean             @default(true)
  socio_economic_level SocialEconomicLevel
  scholarship          Scholarship
  evaluations          Evaluation[]
  user                 User                @relation(fields: [id], references: [id])
  avaliacoesIvcf20     AvaliacaoIvcf20[]

  @@map("patient")
}

model SensorData {
  id           String     @id @default(uuid())
  timestamp    DateTime
  accel_x      Float
  accel_y      Float
  accel_z      Float      @default(0.0)
  gyro_x       Float
  gyro_y       Float
  gyro_z       Float
  evaluationId String
  evaluation   Evaluation @relation(fields: [evaluationId], references: [id])

  @@index([evaluationId])
  @@index([timestamp])
  @@map("sensor_data")
}

model Evaluation {
  id                   String             @id @default(uuid())
  patientId            String
  healthProfessionalId String
  healthcareUnitId     String
  date                 DateTime           @db.Date
  updatedAt            DateTime           @updatedAt
  type                 TypeEvaluation
  time_end             DateTime           @db.Timestamp(6)
  time_init            DateTime           @db.Timestamp(6)
  healthProfessional   HealthProfessional @relation(fields: [healthProfessionalId], references: [id])
  healthcareUnit       HealthcareUnit     @relation(fields: [healthcareUnitId], references: [id])
  patient              Patient            @relation(fields: [patientId], references: [id])
  sensorData           SensorData[]
  avaliacaoIvcf20      AvaliacaoIvcf20?

  @@index([patientId])
  @@index([healthProfessionalId])
  @@index([healthcareUnitId])
  @@index([date])
  @@index([type])
  @@map("evaluation")
}

model HealthcareUnit {
  id              String       @id @default(uuid())
  name            String
  name_normalized String       @default("") @db.Text
  zipCode         String
  street          String
  number          String
  complement      String?
  city            String
  state           String
  neighborhood    String
  active          Boolean      @default(true)
  evaluations     Evaluation[]

  @@index([name_normalized])
  @@index([active])
  @@map("healthcare_unit")
}

enum SystemRole {
  MANAGER
  PATIENT
  RESEARCHER
  HEALTH_PROFESSIONAL
}

enum Gender {
  MALE
  FEMALE
  OTHER
}

enum Scholarship {
  NONE
  FUNDAMENTAL_INCOMPLETE
  FUNDAMENTAL_COMPLETE
  HIGH_SCHOOL_INCOMPLETE
  HIGH_SCHOOL_COMPLETE
  HIGHER_EDUCATION_INCOMPLETE
  HIGHER_EDUCATION_COMPLETE
  POSTGRADUATE
  MASTERS
  DOCTORATE
}

enum SocialEconomicLevel {
  A
  B
  C
  D
  E
}

enum TypeEvaluation {
  FTSTS
  TUG
  IVCF20
}

model AvaliacaoIvcf20 {
  id String @id @default(uuid())

  // Relacionamento com a tabela Patient (Pessoa Idosa)
  patientId String
  patient   Patient @relation(fields: [patientId], references: [id])

  // Relacionamento com a tabela HealthProfessional (Profissional de Saúde que aplicou)
  healthProfessionalId String
  healthProfessional   HealthProfessional @relation(fields: [healthProfessionalId], references: [id])

  // Relacionamento com a tabela Evaluation
  evaluationId String     @unique
  evaluation   Evaluation @relation(fields: [evaluationId], references: [id])

  // Data da aplicação
  date DateTime @default(now()) @db.Date

  // Pontuação total
  totalScore Int

  // Classificação do Risco
  riskClassification RiskClassification

  // --- Seção 1: Idade e Auto-Percepção da Saúde ---
  ageGroup             AgeGroup
  selfPerceptionHealth SelfPerceptionHealth

  // --- Seção 2: Atividades de Vida Diária (AVD) ---
  avdInstrumentalShopping  Boolean
  avdInstrumentalFinance   Boolean
  avdInstrumentalHousework Boolean
  avdBasicBathing          Boolean

  // --- Seção 3: Cognição ---
  cognitionFamilyAlert Boolean
  cognitionWorsening   Boolean
  cognitionImpediment  Boolean

  // --- Seção 4: Humor ---
  humorDespair        Boolean
  humorLossOfInterest Boolean

  // --- Seção 5: Mobilidade ---
  mobilityFineMotor         Boolean
  mobilityWalkingDifficulty Boolean
  mobilityFalls             Boolean

  // --- Seção 6: Comunicação ---
  communicationHearing  Boolean
  communicationSpeaking Boolean

  // --- Seção 7: Comorbidades ---
  comorbiditiesFiveOrMore     Boolean
  comorbiditiesFiveOrMoreMeds Boolean

  // --- Seção 8: Sinais de Alerta ---
  alertSignsIncontinence         Boolean
  alertSignsWeightLoss           Boolean
  alertSignsLowBMI               Boolean
  alertSignsLowCalfCircumference Boolean
  alertSignsSlowGaitSpeed        Boolean

  // Campos de metadados
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("ivcf20_evaluation")
}

enum RiskClassification {
  LOW_RISK
  MODERATE_RISK
  HIGH_RISK
}

enum AgeGroup {
  AGE_60_74
  AGE_75_84
  AGE_85_PLUS
}

enum SelfPerceptionHealth {
  EXCELLENT_VERYGOOD_GOOD
  REGULAR_OR_BAD
}
