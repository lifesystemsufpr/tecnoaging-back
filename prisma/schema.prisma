generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                  String              @id @default(uuid())
  cpf                 String              @unique
  fullName            String
  fullName_normalized String              @default("") @db.Text
  password            String
  active              Boolean             @default(true)
  gender              Gender
  role                SystemRole
  phone               String?             
  
  createdAt           DateTime            @default(now())
  updatedAt           DateTime            @default(now()) @updatedAt

  healthProfessional  HealthProfessional?
  patient             Patient?
  researcher          Researcher?

  @@index([fullName_normalized])
  @@map("tecnoAging_user")
}

model Researcher {
  id            String      @id @unique
  email         String      @unique
  institutionId String
  fieldOfStudy  String?
  active        Boolean     @default(true)
  
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @default(now()) @updatedAt

  user          User        @relation(fields: [id], references: [id])
  institution   Institution @relation(fields: [institutionId], references: [id])

  @@index([institutionId])
  @@map("researcher")
}

model HealthProfessional {
  id                    String       @id @unique
  email                 String       @unique
  active                Boolean      @default(true)
  speciality            String
  speciality_normalized String       @default("") @db.Text
  
  createdAt             DateTime     @default(now())
  updatedAt             DateTime     @default(now()) @updatedAt

  evaluation            Evaluation[]
  user                  User         @relation(fields: [id], references: [id])

  @@index([speciality])
  @@index([speciality_normalized])
  @@index([active])
  @@map("health_professional")
}

model Institution {
  id               String       @id @default(uuid())
  title            String
  title_normalized String       @default("") @db.Text
  active           Boolean      @default(true)
  
  createdAt        DateTime     @default(now())
  updatedAt        DateTime     @default(now()) @updatedAt

  researchers      Researcher[]

  @@index([title_normalized])
  @@index([active])
  @@map("institution")
}

model Patient {
  id                   String              @id @unique
  birthday             DateTime            @db.Date
  weight               Int                 @default(0) 
  height               Int                 @default(0) 
  zipCode              String
  street               String
  number               String
  complement           String?
  city                 String
  state                String
  neighborhood         String
  active               Boolean             @default(true)
  socio_economic_level SocialEconomicLevel
  scholarship          Scholarship
  
  createdAt            DateTime            @default(now())
  updatedAt            DateTime            @default(now()) @updatedAt

  evaluations          Evaluation[]
  user                 User                @relation(fields: [id], references: [id])

  @@map("patient")
}

model SensorData {
  id           String     @id @default(uuid())
  timestamp    DateTime
  accel_x      Float      @default(0.0)
  accel_y      Float      @default(0.0)
  accel_z      Float      @default(0.0)
  gyro_x       Float      @default(0.0)
  gyro_y       Float      @default(0.0)
  gyro_z       Float      @default(0.0)
  filtered     Boolean    @default(false)
  
  createdAt    DateTime   @default(now()) 
  
  evaluationId String
  evaluation   Evaluation @relation(fields: [evaluationId], references: [id], onDelete: Cascade)

  @@index([evaluationId])
  @@index([timestamp])
  @@index([evaluationId, filtered])
  @@map("sensor_data")
}

model Evaluation {
  id                   String             @id @default(uuid())
  patientId            String
  healthProfessionalId String
  healthcareUnitId     String
  date                 DateTime           @default(now()) @db.Date
  type                 TypeEvaluation
  time_end             DateTime           @db.Timestamp(6)
  time_init            DateTime           @db.Timestamp(6)
  
  createdAt            DateTime           @default(now())
  updatedAt            DateTime           @default(now()) @updatedAt

  healthProfessional   HealthProfessional @relation(fields: [healthProfessionalId], references: [id])
  healthcareUnit       HealthcareUnit     @relation(fields: [healthcareUnitId], references: [id])
  patient              Patient            @relation(fields: [patientId], references: [id])
  sensorData           SensorData[]

  @@index([patientId])
  @@index([healthProfessionalId])
  @@index([healthcareUnitId])
  @@index([date])
  @@index([type])
  @@index([time_end(sort: Desc)])
  @@map("evaluation")
}

model HealthcareUnit {
  id              String       @id @default(uuid())
  name            String
  name_normalized String       @default("") @db.Text
  zipCode         String
  street          String
  number          String
  complement      String?
  city            String
  state           String
  neighborhood    String
  active          Boolean      @default(true)
  
  createdAt       DateTime     @default(now())
  updatedAt       DateTime     @default(now()) @updatedAt

  evaluations     Evaluation[]

  @@index([name_normalized])
  @@index([active])
  @@map("healthcare_unit")
}

enum SystemRole {
  MANAGER
  PATIENT
  RESEARCHER
  HEALTH_PROFESSIONAL
}

enum Gender {
  MALE
  FEMALE
  OTHER
}

enum Scholarship {
  NONE
  FUNDAMENTAL_INCOMPLETE
  FUNDAMENTAL_COMPLETE
  HIGH_SCHOOL_INCOMPLETE
  HIGH_SCHOOL_COMPLETE
  HIGHER_EDUCATION_INCOMPLETE
  HIGHER_EDUCATION_COMPLETE
  POSTGRADUATE
  MASTERS
  DOCTORATE
}

enum SocialEconomicLevel {
  A
  B
  C
  D
  E
}

enum TypeEvaluation {
  FTSTS
  TTSTS
}